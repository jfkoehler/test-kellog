
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>&lt;no title&gt; &#8212; Test 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<p><strong>Introduction</strong></p>
<p>This kernel is an attempt to use every trick in the books to unleash the full power of Linear Regression, including a lot of preprocessing and a look at several Regularization algorithms.</p>
<p>At the time of writing, it achieves a score of about 0.121 on the public LB, just using regression, no RF, no xgboost, no ensembling etc. All comments/corrections are more than welcome.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="k">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">RidgeCV</span><span class="p">,</span> <span class="n">LassoCV</span><span class="p">,</span> <span class="n">ElasticNetCV</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">make_scorer</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">skew</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># Definitions</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.float_format&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1">#njobs = 4</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Get data</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/ames_train.csv&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;train : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-2-cc6c67b7947b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-fg"># Get data</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>train <span class="ansi-blue-fg">=</span> pd<span class="ansi-blue-fg">.</span>read_csv<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;data/ames_train.csv&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;train : &#34;</span> <span class="ansi-blue-fg">+</span> str<span class="ansi-blue-fg">(</span>train<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pandas/io/parsers.py</span> in <span class="ansi-cyan-fg">parser_f</span><span class="ansi-blue-fg">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, dialect, tupleize_cols, error_bad_lines, warn_bad_lines, delim_whitespace, low_memory, memory_map, float_precision)</span>
<span class="ansi-green-intense-fg ansi-bold">    700</span>                     skip_blank_lines=skip_blank_lines)
<span class="ansi-green-intense-fg ansi-bold">    701</span>
<span class="ansi-green-fg">--&gt; 702</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> _read<span class="ansi-blue-fg">(</span>filepath_or_buffer<span class="ansi-blue-fg">,</span> kwds<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    703</span>
<span class="ansi-green-intense-fg ansi-bold">    704</span>     parser_f<span class="ansi-blue-fg">.</span>__name__ <span class="ansi-blue-fg">=</span> name

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pandas/io/parsers.py</span> in <span class="ansi-cyan-fg">_read</span><span class="ansi-blue-fg">(filepath_or_buffer, kwds)</span>
<span class="ansi-green-intense-fg ansi-bold">    427</span>
<span class="ansi-green-intense-fg ansi-bold">    428</span>     <span class="ansi-red-fg"># Create the parser.</span>
<span class="ansi-green-fg">--&gt; 429</span><span class="ansi-red-fg">     </span>parser <span class="ansi-blue-fg">=</span> TextFileReader<span class="ansi-blue-fg">(</span>filepath_or_buffer<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwds<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    430</span>
<span class="ansi-green-intense-fg ansi-bold">    431</span>     <span class="ansi-green-fg">if</span> chunksize <span class="ansi-green-fg">or</span> iterator<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pandas/io/parsers.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, f, engine, **kwds)</span>
<span class="ansi-green-intense-fg ansi-bold">    893</span>             self<span class="ansi-blue-fg">.</span>options<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;has_index_names&#39;</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> kwds<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;has_index_names&#39;</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    894</span>
<span class="ansi-green-fg">--&gt; 895</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>_make_engine<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>engine<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    896</span>
<span class="ansi-green-intense-fg ansi-bold">    897</span>     <span class="ansi-green-fg">def</span> close<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pandas/io/parsers.py</span> in <span class="ansi-cyan-fg">_make_engine</span><span class="ansi-blue-fg">(self, engine)</span>
<span class="ansi-green-intense-fg ansi-bold">   1120</span>     <span class="ansi-green-fg">def</span> _make_engine<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> engine<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;c&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1121</span>         <span class="ansi-green-fg">if</span> engine <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#39;c&#39;</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1122</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>_engine <span class="ansi-blue-fg">=</span> CParserWrapper<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>f<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>self<span class="ansi-blue-fg">.</span>options<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1123</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1124</span>             <span class="ansi-green-fg">if</span> engine <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#39;python&#39;</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pandas/io/parsers.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, src, **kwds)</span>
<span class="ansi-green-intense-fg ansi-bold">   1851</span>         kwds<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;usecols&#39;</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>usecols
<span class="ansi-green-intense-fg ansi-bold">   1852</span>
<span class="ansi-green-fg">-&gt; 1853</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>_reader <span class="ansi-blue-fg">=</span> parsers<span class="ansi-blue-fg">.</span>TextReader<span class="ansi-blue-fg">(</span>src<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwds<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1854</span>         self<span class="ansi-blue-fg">.</span>unnamed_cols <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_reader<span class="ansi-blue-fg">.</span>unnamed_cols
<span class="ansi-green-intense-fg ansi-bold">   1855</span>

<span class="ansi-green-fg">pandas/_libs/parsers.pyx</span> in <span class="ansi-cyan-fg">pandas._libs.parsers.TextReader.__cinit__</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">pandas/_libs/parsers.pyx</span> in <span class="ansi-cyan-fg">pandas._libs.parsers.TextReader._setup_parser_source</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] File b&#39;data/ames_train.csv&#39; does not exist: b&#39;data/ames_train.csv&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check for duplicates</span>
<span class="n">idsUnique</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">Id</span><span class="p">))</span>
<span class="n">idsTotal</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">idsDupli</span> <span class="o">=</span> <span class="n">idsTotal</span> <span class="o">-</span> <span class="n">idsUnique</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There are &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idsDupli</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; duplicate IDs for &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idsTotal</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; total entries&quot;</span><span class="p">)</span>

<span class="c1"># Drop Id column</span>
<span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
There are 0 duplicate IDs for 1460 total entries
</pre></div></div>
</div>
<p><strong>Preprocessing</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Looking for outliers, as indicated in https://ww2.amstat.org/publications/jse/v19n3/decock.pdf</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">GrLivArea</span><span class="p">,</span> <span class="n">train</span><span class="o">.</span><span class="n">SalePrice</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Looking for outliers&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;GrLivArea&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="o">.</span><span class="n">GrLivArea</span> <span class="o">&lt;</span> <span class="mi">4000</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_5_0.png" src="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_5_0.png" />
</div>
</div>
<div class="line-block">
<div class="line">There seems to be 2 extreme outliers on the bottom right, really large houses that sold for really cheap. More generally, the author of the dataset recommends removing ‘any houses with more than 4000 square feet’ from the dataset.</div>
<div class="line">Reference : <a class="reference external" href="https://ww2.amstat.org/publications/jse/v19n3/decock.pdf">https://ww2.amstat.org/publications/jse/v19n3/decock.pdf</a></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Log transform the target for official scoring</span>
<span class="n">train</span><span class="o">.</span><span class="n">SalePrice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">SalePrice</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">SalePrice</span>
</pre></div>
</div>
</div>
<p>Taking logs means that errors in predicting expensive houses and cheap houses will affect the result equally.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Handle missing values for features where median/mean or most common value doesn&#39;t make sense</span>

<span class="c1"># Alley : data description says NA means &quot;no alley access&quot;</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Alley&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Alley&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
<span class="c1"># BedroomAbvGr : NA most likely means 0</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BedroomAbvGr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BedroomAbvGr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># BsmtQual etc : data description says NA for basement features is &quot;no basement&quot;</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtQual&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtCond&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtCond&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtExposure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtExposure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtFinType1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtFinType1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtFinType2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtFinType2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtFullBath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtFullBath&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtHalfBath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtHalfBath&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtUnfSF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BsmtUnfSF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># CentralAir : NA most likely means No</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;CentralAir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;CentralAir&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)</span>
<span class="c1"># Condition : NA most likely means Normal</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Condition1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Condition1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;Norm&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Condition2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Condition2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;Norm&quot;</span><span class="p">)</span>
<span class="c1"># EnclosedPorch : NA most likely means no enclosed porch</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;EnclosedPorch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;EnclosedPorch&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># External stuff : NA most likely means average</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;ExterCond&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;ExterCond&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;TA&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;ExterQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;ExterQual&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;TA&quot;</span><span class="p">)</span>
<span class="c1"># Fence : data description says NA means &quot;no fence&quot;</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Fence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Fence&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="c1"># FireplaceQu : data description says NA means &quot;no fireplace&quot;</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;FireplaceQu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;FireplaceQu&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Fireplaces&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Fireplaces&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Functional : data description says NA means typical</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Functional&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Functional&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;Typ&quot;</span><span class="p">)</span>
<span class="c1"># GarageType etc : data description says NA for garage features is &quot;no garage&quot;</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;GarageType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;GarageType&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;GarageFinish&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;GarageFinish&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;GarageQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;GarageQual&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;GarageCond&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;GarageCond&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;GarageArea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;GarageArea&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;GarageCars&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;GarageCars&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># HalfBath : NA most likely means no half baths above grade</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;HalfBath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;HalfBath&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># HeatingQC : NA most likely means typical</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;HeatingQC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;HeatingQC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;TA&quot;</span><span class="p">)</span>
<span class="c1"># KitchenAbvGr : NA most likely means 0</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;KitchenAbvGr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;KitchenAbvGr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># KitchenQual : NA most likely means typical</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;KitchenQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;KitchenQual&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;TA&quot;</span><span class="p">)</span>
<span class="c1"># LotFrontage : NA most likely means no lot frontage</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;LotFrontage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;LotFrontage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># LotShape : NA most likely means regular</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;LotShape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;LotShape&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;Reg&quot;</span><span class="p">)</span>
<span class="c1"># MasVnrType : NA most likely means no veneer</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;MasVnrType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;MasVnrType&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;MasVnrArea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;MasVnrArea&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># MiscFeature : data description says NA means &quot;no misc feature&quot;</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;MiscFeature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;MiscFeature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;MiscVal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;MiscVal&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># OpenPorchSF : NA most likely means no open porch</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;OpenPorchSF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;OpenPorchSF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># PavedDrive : NA most likely means not paved</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;PavedDrive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;PavedDrive&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)</span>
<span class="c1"># PoolQC : data description says NA means &quot;no pool&quot;</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;PoolQC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;PoolQC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;PoolArea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;PoolArea&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># SaleCondition : NA most likely means normal sale</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;SaleCondition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;SaleCondition&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;Normal&quot;</span><span class="p">)</span>
<span class="c1"># ScreenPorch : NA most likely means no screen porch</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;ScreenPorch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;ScreenPorch&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># TotRmsAbvGrd : NA most likely means 0</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;TotRmsAbvGrd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;TotRmsAbvGrd&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Utilities : NA most likely means all public utilities</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Utilities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Utilities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;AllPub&quot;</span><span class="p">)</span>
<span class="c1"># WoodDeckSF : NA most likely means no wood deck</span>
<span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;WoodDeckSF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;WoodDeckSF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Some numerical features are actually really categories</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s2">&quot;MSSubClass&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="mi">20</span> <span class="p">:</span> <span class="s2">&quot;SC20&quot;</span><span class="p">,</span> <span class="mi">30</span> <span class="p">:</span> <span class="s2">&quot;SC30&quot;</span><span class="p">,</span> <span class="mi">40</span> <span class="p">:</span> <span class="s2">&quot;SC40&quot;</span><span class="p">,</span> <span class="mi">45</span> <span class="p">:</span> <span class="s2">&quot;SC45&quot;</span><span class="p">,</span>
                                       <span class="mi">50</span> <span class="p">:</span> <span class="s2">&quot;SC50&quot;</span><span class="p">,</span> <span class="mi">60</span> <span class="p">:</span> <span class="s2">&quot;SC60&quot;</span><span class="p">,</span> <span class="mi">70</span> <span class="p">:</span> <span class="s2">&quot;SC70&quot;</span><span class="p">,</span> <span class="mi">75</span> <span class="p">:</span> <span class="s2">&quot;SC75&quot;</span><span class="p">,</span>
                                       <span class="mi">80</span> <span class="p">:</span> <span class="s2">&quot;SC80&quot;</span><span class="p">,</span> <span class="mi">85</span> <span class="p">:</span> <span class="s2">&quot;SC85&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="p">:</span> <span class="s2">&quot;SC90&quot;</span><span class="p">,</span> <span class="mi">120</span> <span class="p">:</span> <span class="s2">&quot;SC120&quot;</span><span class="p">,</span>
                                       <span class="mi">150</span> <span class="p">:</span> <span class="s2">&quot;SC150&quot;</span><span class="p">,</span> <span class="mi">160</span> <span class="p">:</span> <span class="s2">&quot;SC160&quot;</span><span class="p">,</span> <span class="mi">180</span> <span class="p">:</span> <span class="s2">&quot;SC180&quot;</span><span class="p">,</span> <span class="mi">190</span> <span class="p">:</span> <span class="s2">&quot;SC190&quot;</span><span class="p">},</span>
                       <span class="s2">&quot;MoSold&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="mi">1</span> <span class="p">:</span> <span class="s2">&quot;Jan&quot;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">:</span> <span class="s2">&quot;Feb&quot;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="s2">&quot;Mar&quot;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">:</span> <span class="s2">&quot;Apr&quot;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="s2">&quot;May&quot;</span><span class="p">,</span> <span class="mi">6</span> <span class="p">:</span> <span class="s2">&quot;Jun&quot;</span><span class="p">,</span>
                                   <span class="mi">7</span> <span class="p">:</span> <span class="s2">&quot;Jul&quot;</span><span class="p">,</span> <span class="mi">8</span> <span class="p">:</span> <span class="s2">&quot;Aug&quot;</span><span class="p">,</span> <span class="mi">9</span> <span class="p">:</span> <span class="s2">&quot;Sep&quot;</span><span class="p">,</span> <span class="mi">10</span> <span class="p">:</span> <span class="s2">&quot;Oct&quot;</span><span class="p">,</span> <span class="mi">11</span> <span class="p">:</span> <span class="s2">&quot;Nov&quot;</span><span class="p">,</span> <span class="mi">12</span> <span class="p">:</span> <span class="s2">&quot;Dec&quot;</span><span class="p">}</span>
                      <span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Encode some categorical features as ordered numbers when there is information in the order</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s2">&quot;Alley&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Grvl&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Pave&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
                       <span class="s2">&quot;BsmtCond&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;No&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Po&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Fa&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;TA&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
                       <span class="s2">&quot;BsmtExposure&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;No&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Mn&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Av&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
                       <span class="s2">&quot;BsmtFinType1&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;No&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Unf&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;LwQ&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Rec&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;BLQ&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                                         <span class="s2">&quot;ALQ&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;GLQ&quot;</span> <span class="p">:</span> <span class="mi">6</span><span class="p">},</span>
                       <span class="s2">&quot;BsmtFinType2&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;No&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Unf&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;LwQ&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Rec&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;BLQ&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                                         <span class="s2">&quot;ALQ&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;GLQ&quot;</span> <span class="p">:</span> <span class="mi">6</span><span class="p">},</span>
                       <span class="s2">&quot;BsmtQual&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;No&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Po&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Fa&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;TA&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
                       <span class="s2">&quot;ExterCond&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Po&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Fa&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;TA&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
                       <span class="s2">&quot;ExterQual&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Po&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Fa&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;TA&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
                       <span class="s2">&quot;FireplaceQu&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;No&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Po&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Fa&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;TA&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
                       <span class="s2">&quot;Functional&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Sal&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Sev&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Maj2&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Maj1&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Mod&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                                       <span class="s2">&quot;Min2&quot;</span> <span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;Min1&quot;</span> <span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;Typ&quot;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">},</span>
                       <span class="s2">&quot;GarageCond&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;No&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Po&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Fa&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;TA&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
                       <span class="s2">&quot;GarageQual&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;No&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Po&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Fa&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;TA&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
                       <span class="s2">&quot;HeatingQC&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Po&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Fa&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;TA&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
                       <span class="s2">&quot;KitchenQual&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Po&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Fa&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;TA&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
                       <span class="s2">&quot;LandSlope&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Sev&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Mod&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Gtl&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
                       <span class="s2">&quot;LotShape&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;IR3&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;IR2&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;IR1&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Reg&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
                       <span class="s2">&quot;PavedDrive&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;N&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
                       <span class="s2">&quot;PoolQC&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;No&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Fa&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;TA&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
                       <span class="s2">&quot;Street&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Grvl&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Pave&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
                       <span class="s2">&quot;Utilities&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ELO&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;NoSeWa&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;NoSewr&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;AllPub&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">}}</span>
                     <span class="p">)</span>
</pre></div>
</div>
</div>
<p>Then we will create new features, in 3 ways :</p>
<ol class="arabic simple">
<li><p>Simplifications of existing features</p></li>
<li><p>Combinations of existing features</p></li>
<li><p>Polynomials on the top 10 existing features</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create new features</span>
<span class="c1"># 1* Simplifications of existing features</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplOverallQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">OverallQual</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># bad</span>
                                                       <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="c1"># average</span>
                                                       <span class="mi">7</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span> <span class="p">:</span> <span class="mi">3</span> <span class="c1"># good</span>
                                                      <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplOverallCond&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">OverallCond</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># bad</span>
                                                       <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="c1"># average</span>
                                                       <span class="mi">7</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span> <span class="p">:</span> <span class="mi">3</span> <span class="c1"># good</span>
                                                      <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplPoolQC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">PoolQC</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># average</span>
                                             <span class="mi">3</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span> <span class="c1"># good</span>
                                            <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplGarageCond&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">GarageCond</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># bad</span>
                                                     <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># average</span>
                                                     <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span> <span class="c1"># good</span>
                                                    <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplGarageQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">GarageQual</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># bad</span>
                                                     <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># average</span>
                                                     <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span> <span class="c1"># good</span>
                                                    <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplFireplaceQu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">FireplaceQu</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># bad</span>
                                                       <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># average</span>
                                                       <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span> <span class="c1"># good</span>
                                                      <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplFireplaceQu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">FireplaceQu</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># bad</span>
                                                       <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># average</span>
                                                       <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span> <span class="c1"># good</span>
                                                      <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplFunctional&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">Functional</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># bad</span>
                                                     <span class="mi">3</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="c1"># major</span>
                                                     <span class="mi">5</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="c1"># minor</span>
                                                     <span class="mi">8</span> <span class="p">:</span> <span class="mi">4</span> <span class="c1"># typical</span>
                                                    <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplKitchenQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">KitchenQual</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># bad</span>
                                                       <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># average</span>
                                                       <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span> <span class="c1"># good</span>
                                                      <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplHeatingQC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">HeatingQC</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># bad</span>
                                                   <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># average</span>
                                                   <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span> <span class="c1"># good</span>
                                                  <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplBsmtFinType1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">BsmtFinType1</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># unfinished</span>
                                                         <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># rec room</span>
                                                         <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span> <span class="p">:</span> <span class="mi">2</span> <span class="c1"># living quarters</span>
                                                        <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplBsmtFinType2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">BsmtFinType2</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># unfinished</span>
                                                         <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># rec room</span>
                                                         <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span> <span class="p">:</span> <span class="mi">2</span> <span class="c1"># living quarters</span>
                                                        <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplBsmtCond&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">BsmtCond</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># bad</span>
                                                 <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># average</span>
                                                 <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span> <span class="c1"># good</span>
                                                <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplBsmtQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">BsmtQual</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># bad</span>
                                                 <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># average</span>
                                                 <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span> <span class="c1"># good</span>
                                                <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplExterCond&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">ExterCond</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># bad</span>
                                                   <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># average</span>
                                                   <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span> <span class="c1"># good</span>
                                                  <span class="p">})</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplExterQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">ExterQual</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># bad</span>
                                                   <span class="mi">2</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># average</span>
                                                   <span class="mi">4</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">2</span> <span class="c1"># good</span>
                                                  <span class="p">})</span>

<span class="c1"># 2* Combinations of existing features</span>
<span class="c1"># Overall quality of the house</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;OverallGrade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;OverallCond&quot;</span><span class="p">]</span>
<span class="c1"># Overall quality of the garage</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageGrade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageQual&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageCond&quot;</span><span class="p">]</span>
<span class="c1"># Overall quality of the exterior</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;ExterGrade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;ExterCond&quot;</span><span class="p">]</span>
<span class="c1"># Overall kitchen score</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;KitchenScore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;KitchenAbvGr&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;KitchenQual&quot;</span><span class="p">]</span>
<span class="c1"># Overall fireplace score</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;FireplaceScore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;Fireplaces&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;FireplaceQu&quot;</span><span class="p">]</span>
<span class="c1"># Overall garage score</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageScore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageArea&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageQual&quot;</span><span class="p">]</span>
<span class="c1"># Overall pool score</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;PoolScore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;PoolArea&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;PoolQC&quot;</span><span class="p">]</span>
<span class="c1"># Simplified overall quality of the house</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplOverallGrade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplOverallQual&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplOverallCond&quot;</span><span class="p">]</span>
<span class="c1"># Simplified overall quality of the exterior</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplExterGrade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplExterQual&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplExterCond&quot;</span><span class="p">]</span>
<span class="c1"># Simplified overall pool score</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplPoolScore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;PoolArea&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplPoolQC&quot;</span><span class="p">]</span>
<span class="c1"># Simplified overall garage score</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplGarageScore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageArea&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplGarageQual&quot;</span><span class="p">]</span>
<span class="c1"># Simplified overall fireplace score</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplFireplaceScore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;Fireplaces&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplFireplaceQu&quot;</span><span class="p">]</span>
<span class="c1"># Simplified overall kitchen score</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplKitchenScore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;KitchenAbvGr&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplKitchenQual&quot;</span><span class="p">]</span>
<span class="c1"># Total number of bathrooms</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;TotalBath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;BsmtFullBath&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;BsmtHalfBath&quot;</span><span class="p">])</span> <span class="o">+</span> \
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;FullBath&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;HalfBath&quot;</span><span class="p">])</span>
<span class="c1"># Total SF for house (incl. basement)</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllSF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;GrLivArea&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;TotalBsmtSF&quot;</span><span class="p">]</span>
<span class="c1"># Total SF for 1st + 2nd floors</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllFlrsSF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;1stFlrSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;2ndFlrSF&quot;</span><span class="p">]</span>
<span class="c1"># Total SF for porch</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllPorchSF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;OpenPorchSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;EnclosedPorch&quot;</span><span class="p">]</span> <span class="o">+</span> \
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;3SsnPorch&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;ScreenPorch&quot;</span><span class="p">]</span>
<span class="c1"># Has masonry veneer or not</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;HasMasVnr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">MasVnrType</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s2">&quot;BrkCmn&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;BrkFace&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;CBlock&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                               <span class="s2">&quot;Stone&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="c1"># House completed before sale or not</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;BoughtOffPlan&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">SaleCondition</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s2">&quot;Abnorml&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Alloca&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;AdjLand&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                                      <span class="s2">&quot;Family&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Normal&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Partial&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Find most important features relative to target</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Find most important features relative to target&quot;</span><span class="p">)</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">corr</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr</span><span class="o">.</span><span class="n">SalePrice</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Find most important features relative to target
SalePrice            1.000
OverallQual          0.819
AllSF                0.817
AllFlrsSF            0.729
GrLivArea            0.719
SimplOverallQual     0.708
ExterQual            0.681
GarageCars           0.680
TotalBath            0.673
KitchenQual          0.667
GarageScore          0.657
GarageArea           0.655
TotalBsmtSF          0.642
SimplExterQual       0.636
SimplGarageScore     0.631
BsmtQual             0.615
1stFlrSF             0.614
SimplKitchenQual     0.610
OverallGrade         0.604
SimplBsmtQual        0.594
FullBath             0.591
YearBuilt            0.589
ExterGrade           0.587
YearRemodAdd         0.569
FireplaceQu          0.547
GarageYrBlt          0.544
TotRmsAbvGrd         0.533
SimplOverallGrade    0.527
SimplKitchenScore    0.523
FireplaceScore       0.518
                     ...
SimplBsmtCond        0.204
BedroomAbvGr         0.204
AllPorchSF           0.199
LotFrontage          0.174
SimplFunctional      0.137
Functional           0.136
ScreenPorch          0.124
SimplBsmtFinType2    0.105
Street               0.058
3SsnPorch            0.056
ExterCond            0.051
PoolArea             0.041
SimplPoolScore       0.040
SimplPoolQC          0.040
PoolScore            0.040
PoolQC               0.038
BsmtFinType2         0.016
Utilities            0.013
BsmtFinSF2           0.006
BsmtHalfBath        -0.015
MiscVal             -0.020
SimplOverallCond    -0.028
YrSold              -0.034
OverallCond         -0.037
LowQualFinSF        -0.038
LandSlope           -0.040
SimplExterCond      -0.042
KitchenAbvGr        -0.148
EnclosedPorch       -0.149
LotShape            -0.286
Name: SalePrice, dtype: float64
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create new features</span>
<span class="c1"># 3* Polynomials on the top 10 existing features</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;OverallQual-s2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;OverallQual-s3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;OverallQual-Sq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">])</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllSF-2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllSF&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllSF-3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllSF&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllSF-Sq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllSF&quot;</span><span class="p">])</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllFlrsSF-2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllFlrsSF&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllFlrsSF-3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllFlrsSF&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllFlrsSF-Sq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;AllFlrsSF&quot;</span><span class="p">])</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;GrLivArea-2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;GrLivArea&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;GrLivArea-3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;GrLivArea&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;GrLivArea-Sq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;GrLivArea&quot;</span><span class="p">])</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplOverallQual-s2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplOverallQual&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplOverallQual-s3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplOverallQual&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplOverallQual-Sq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;SimplOverallQual&quot;</span><span class="p">])</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;ExterQual-2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;ExterQual-3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;ExterQual-Sq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">])</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageCars-2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageCars&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageCars-3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageCars&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageCars-Sq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageCars&quot;</span><span class="p">])</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;TotalBath-2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;TotalBath&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;TotalBath-3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;TotalBath&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;TotalBath-Sq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;TotalBath&quot;</span><span class="p">])</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;KitchenQual-2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;KitchenQual&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;KitchenQual-3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;KitchenQual&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;KitchenQual-Sq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;KitchenQual&quot;</span><span class="p">])</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageScore-2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageScore&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageScore-3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageScore&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageScore-Sq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;GarageScore&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Differentiate numerical features (minus the target) and categorical features</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">numerical_features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Numerical features : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numerical_features</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Categorical features : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">categorical_features</span><span class="p">)))</span>
<span class="n">train_num</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">numerical_features</span><span class="p">]</span>
<span class="n">train_cat</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">categorical_features</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Numerical features : 117
Categorical features : 26
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Handle remaining missing values for numerical features by using median as replacement</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NAs for numerical features in train : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">train_num</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
<span class="n">train_num</span> <span class="o">=</span> <span class="n">train_num</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">train_num</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remaining NAs for numerical features in train : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">train_num</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
NAs for numerical features in train : 81
Remaining NAs for numerical features in train : 0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Log transform of the skewed numerical features to lessen impact of outliers</span>
<span class="c1"># Inspired by Alexandru Papiu&#39;s script : https://www.kaggle.com/apapiu/house-prices-advanced-regression-techniques/regularized-linear-models</span>
<span class="c1"># As a general rule of thumb, a skewness with an absolute value &gt; 0.5 is considered at least moderately skewed</span>
<span class="n">skewness</span> <span class="o">=</span> <span class="n">train_num</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">skewness</span> <span class="o">=</span> <span class="n">skewness</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">skewness</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">skewness</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; skewed numerical features to log transform&quot;</span><span class="p">)</span>
<span class="n">skewed_features</span> <span class="o">=</span> <span class="n">skewness</span><span class="o">.</span><span class="n">index</span>
<span class="n">train_num</span><span class="p">[</span><span class="n">skewed_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">train_num</span><span class="p">[</span><span class="n">skewed_features</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
86 skewed numerical features to log transform
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create dummy features for categorical values via one-hot encoding</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NAs for categorical features in train : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">train_cat</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
<span class="n">train_cat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">train_cat</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remaining NAs for categorical features in train : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">train_cat</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
NAs for categorical features in train : 1
Remaining NAs for categorical features in train : 0
</pre></div></div>
</div>
<p><strong>Modeling</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Join categorical and numerical features</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_num</span><span class="p">,</span> <span class="n">train_cat</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;New number of features : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="c1"># Partition the dataset in train + validation sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X_train : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X_test : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y_train : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y_test : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
New number of features : 319
X_train : (1019, 319)
X_test : (437, 319)
y_train : (1019,)
y_test : (437,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Standardize numerical features</span>
<span class="n">stdSc</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">numerical_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">stdSc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">numerical_features</span><span class="p">])</span>
<span class="n">X_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">numerical_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">stdSc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">numerical_features</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/opt/conda/lib/python3.5/site-packages/pandas/core/indexing.py:465: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  self.obj[item] = s
</pre></div></div>
</div>
<p>Standardization cannot be done before the partitioning, as we don’t want to fit the StandardScaler on some observations that will later be used in the test set.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Define error measure for official scoring : RMSE</span>
<span class="n">scorer</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">greater_is_better</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">rmse_cv_train</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="n">rmse</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="n">scorer</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">rmse_cv_test</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="n">rmse</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="n">scorer</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Note : I’m not getting nearly the same numbers in local CV compared to public LB, so I’m a tad worried that my CV process may have an issue somewhere. If you spot something, please let me know.</p>
<p><strong>1* Linear Regression without regularization</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Linear Regression</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Look at predictions on training and validation set</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE on Training set :&quot;</span><span class="p">,</span> <span class="n">rmse_cv_train</span><span class="p">(</span><span class="n">lr</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE on Test set :&quot;</span><span class="p">,</span> <span class="n">rmse_cv_test</span><span class="p">(</span><span class="n">lr</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Plot residuals</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train_pred</span><span class="p">,</span> <span class="n">y_train_pred</span> <span class="o">-</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Training data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test_pred</span><span class="p">,</span> <span class="n">y_test_pred</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Validation data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Linear regression&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Predicted values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="mf">10.5</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mf">13.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Plot predictions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train_pred</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Training data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Validation data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Linear regression&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Predicted values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Real values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">10.5</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">10.5</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RMSE on Training set : 15758371373.7
RMSE on Test set : 0.395779797728
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_27_1.png" src="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_27_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_27_2.png" src="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_27_2.png" />
</div>
</div>
<div class="line-block">
<div class="line">RMSE on Training set shows up weird here (not when I run it on my computer) for some reason.</div>
<div class="line">Errors seem randomly distributed and randomly scattered around the centerline, so there is that at least. It means our model was able to capture most of the explanatory information.</div>
</div>
<p><strong>2* Linear Regression with Ridge regularization (L2 penalty)</strong></p>
<p>From the <em>Python Machine Learning</em> book by Sebastian Raschka : Regularization is a very useful method to handle collinearity, filter out noise from data, and eventually prevent overfitting. The concept behind regularization is to introduce additional information (bias) to penalize extreme parameter weights.</p>
<p>Ridge regression is an L2 penalized model where we simply add the squared sum of the weights to our cost function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># 2* Ridge</span>
<span class="n">ridge</span> <span class="o">=</span> <span class="n">RidgeCV</span><span class="p">(</span><span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">])</span>
<span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">alpha_</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best alpha :&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Try again for more precision with alphas centered around &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>
<span class="n">ridge</span> <span class="o">=</span> <span class="n">RidgeCV</span><span class="p">(</span><span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">65</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">75</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">85</span><span class="p">,</span>
                          <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.15</span><span class="p">,</span>
                          <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.3</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.35</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.4</span><span class="p">],</span>
                <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">alpha_</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best alpha :&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ridge RMSE on Training set :&quot;</span><span class="p">,</span> <span class="n">rmse_cv_train</span><span class="p">(</span><span class="n">ridge</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ridge RMSE on Test set :&quot;</span><span class="p">,</span> <span class="n">rmse_cv_test</span><span class="p">(</span><span class="n">ridge</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">y_train_rdg</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">y_test_rdg</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Plot residuals</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train_rdg</span><span class="p">,</span> <span class="n">y_train_rdg</span> <span class="o">-</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Training data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test_rdg</span><span class="p">,</span> <span class="n">y_test_rdg</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Validation data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Linear regression with Ridge regularization&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Predicted values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="mf">10.5</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mf">13.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Plot predictions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train_rdg</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Training data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test_rdg</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Validation data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Linear regression with Ridge regularization&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Predicted values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Real values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">10.5</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">10.5</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Plot important coefficients</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ridge</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ridge picked &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">coefs</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; features and eliminated the other &quot;</span> <span class="o">+</span>  \
      <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">coefs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; features&quot;</span><span class="p">)</span>
<span class="n">imp_coefs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">coefs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
                     <span class="n">coefs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
<span class="n">imp_coefs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;barh&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Coefficients in the Ridge Model&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Best alpha : 30.0
Try again for more precision with alphas centered around 30.0
Best alpha : 24.0
Ridge RMSE on Training set : 0.115405723285
Ridge RMSE on Test set : 0.116427213778
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_30_1.png" src="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_30_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_30_2.png" src="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_30_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ridge picked 316 features and eliminated the other 3 features
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_30_4.png" src="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_30_4.png" />
</div>
</div>
<p>We’re getting a much better RMSE result now that we’ve added regularization. The very small difference between training and test results indicate that we eliminated most of the overfitting. Visually, the graphs seem to confirm that idea.</p>
<p>Ridge used almost all of the existing features.</p>
<p><strong>3* Linear Regression with Lasso regularization (L1 penalty)</strong></p>
<p>LASSO stands for <em>Least Absolute Shrinkage and Selection Operator</em>. It is an alternative regularization method, where we simply replace the square of the weights by the sum of the absolute value of the weights. In contrast to L2 regularization, L1 regularization yields sparse feature vectors : most feature weights will be zero. Sparsity can be useful in practice if we have a high dimensional dataset with many features that are irrelevant.</p>
<p>We can suspect that it should be more efficient than Ridge here.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># 3* Lasso</span>
<span class="n">lasso</span> <span class="o">=</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.0003</span><span class="p">,</span> <span class="mf">0.0006</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">,</span> <span class="mf">0.006</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
                          <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">alpha_</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best alpha :&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Try again for more precision with alphas centered around &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>
<span class="n">lasso</span> <span class="o">=</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">65</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">75</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span>
                          <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">,</span>
                          <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.15</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.3</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.35</span><span class="p">,</span>
                          <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.4</span><span class="p">],</span>
                <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">alpha_</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best alpha :&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lasso RMSE on Training set :&quot;</span><span class="p">,</span> <span class="n">rmse_cv_train</span><span class="p">(</span><span class="n">lasso</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lasso RMSE on Test set :&quot;</span><span class="p">,</span> <span class="n">rmse_cv_test</span><span class="p">(</span><span class="n">lasso</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">y_train_las</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">y_test_las</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Plot residuals</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train_las</span><span class="p">,</span> <span class="n">y_train_las</span> <span class="o">-</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Training data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test_las</span><span class="p">,</span> <span class="n">y_test_las</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Validation data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Linear regression with Lasso regularization&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Predicted values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="mf">10.5</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mf">13.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Plot predictions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train_las</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Training data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test_las</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Validation data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Linear regression with Lasso regularization&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Predicted values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Real values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">10.5</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">10.5</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Plot important coefficients</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lasso</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lasso picked &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">coefs</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; features and eliminated the other &quot;</span> <span class="o">+</span>  \
      <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">coefs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; features&quot;</span><span class="p">)</span>
<span class="n">imp_coefs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">coefs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
                     <span class="n">coefs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
<span class="n">imp_coefs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;barh&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Coefficients in the Lasso Model&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Best alpha : 0.0006
Try again for more precision with alphas centered around 0.0006
Best alpha : 0.0006
Lasso RMSE on Training set : 0.114111508375
Lasso RMSE on Test set : 0.115832132218
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_33_1.png" src="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_33_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_33_2.png" src="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_33_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lasso picked 110 features and eliminated the other 209 features
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_33_4.png" src="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_33_4.png" />
</div>
</div>
<p>RMSE results are better both on training and test sets. The most interesting thing is that Lasso used only one third of the available features. Another interesting tidbit : it seems to give big weights to Neighborhood categories, both in positive and negative ways. Intuitively it makes sense, house prices change a whole lot from one neighborhood to another in the same city.</p>
<p>The “MSZoning_C (all)” feature seems to have a disproportionate impact compared to the others. It is defined as <em>general zoning classification : commercial</em>. It seems a bit weird to me that having your house in a mostly commercial zone would be such a terrible thing.</p>
<p><strong>4* Linear Regression with ElasticNet regularization (L1 and L2 penalty)</strong></p>
<p>ElasticNet is a compromise between Ridge and Lasso regression. It has a L1 penalty to generate sparsity and a L2 penalty to overcome some of the limitations of Lasso, such as the number of variables (Lasso can’t select more features than it has observations, but it’s not the case here anyway).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># 4* ElasticNet</span>
<span class="n">elasticNet</span> <span class="o">=</span> <span class="n">ElasticNetCV</span><span class="p">(</span><span class="n">l1_ratio</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                          <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.0003</span><span class="p">,</span> <span class="mf">0.0006</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">,</span> <span class="mf">0.006</span><span class="p">,</span>
                                    <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">elasticNet</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">elasticNet</span><span class="o">.</span><span class="n">alpha_</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="n">elasticNet</span><span class="o">.</span><span class="n">l1_ratio_</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best l1_ratio :&quot;</span><span class="p">,</span> <span class="n">ratio</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best alpha :&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Try again for more precision with l1_ratio centered around &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ratio</span><span class="p">))</span>
<span class="n">elasticNet</span> <span class="o">=</span> <span class="n">ElasticNetCV</span><span class="p">(</span><span class="n">l1_ratio</span> <span class="o">=</span> <span class="p">[</span><span class="n">ratio</span> <span class="o">*</span> <span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="n">ratio</span> <span class="o">*</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="n">ratio</span> <span class="o">*</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">ratio</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">,</span> <span class="n">ratio</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">ratio</span> <span class="o">*</span> <span class="mf">1.15</span><span class="p">],</span>
                          <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.0003</span><span class="p">,</span> <span class="mf">0.0006</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">,</span> <span class="mf">0.006</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">elasticNet</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">elasticNet</span><span class="o">.</span><span class="n">l1_ratio_</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">elasticNet</span><span class="o">.</span><span class="n">l1_ratio_</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">elasticNet</span><span class="o">.</span><span class="n">alpha_</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="n">elasticNet</span><span class="o">.</span><span class="n">l1_ratio_</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best l1_ratio :&quot;</span><span class="p">,</span> <span class="n">ratio</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best alpha :&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now try again for more precision on alpha, with l1_ratio fixed at &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span> <span class="o">+</span>
      <span class="s2">&quot; and alpha centered around &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>
<span class="n">elasticNet</span> <span class="o">=</span> <span class="n">ElasticNetCV</span><span class="p">(</span><span class="n">l1_ratio</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">,</span>
                          <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">65</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">75</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span>
                                    <span class="n">alpha</span> <span class="o">*</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.15</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.3</span><span class="p">,</span>
                                    <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.35</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1.4</span><span class="p">],</span>
                          <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">elasticNet</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">elasticNet</span><span class="o">.</span><span class="n">l1_ratio_</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">elasticNet</span><span class="o">.</span><span class="n">l1_ratio_</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">elasticNet</span><span class="o">.</span><span class="n">alpha_</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="n">elasticNet</span><span class="o">.</span><span class="n">l1_ratio_</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best l1_ratio :&quot;</span><span class="p">,</span> <span class="n">ratio</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best alpha :&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ElasticNet RMSE on Training set :&quot;</span><span class="p">,</span> <span class="n">rmse_cv_train</span><span class="p">(</span><span class="n">elasticNet</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ElasticNet RMSE on Test set :&quot;</span><span class="p">,</span> <span class="n">rmse_cv_test</span><span class="p">(</span><span class="n">elasticNet</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">y_train_ela</span> <span class="o">=</span> <span class="n">elasticNet</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">y_test_ela</span> <span class="o">=</span> <span class="n">elasticNet</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Plot residuals</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train_ela</span><span class="p">,</span> <span class="n">y_train_ela</span> <span class="o">-</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Training data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test_ela</span><span class="p">,</span> <span class="n">y_test_ela</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Validation data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Linear regression with ElasticNet regularization&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Predicted values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="mf">10.5</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mf">13.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Plot predictions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_ela</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Training data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_ela</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Validation data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Linear regression with ElasticNet regularization&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Predicted values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Real values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">10.5</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">10.5</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Plot important coefficients</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">elasticNet</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ElasticNet picked &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">coefs</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; features and eliminated the other &quot;</span> <span class="o">+</span>  <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">coefs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; features&quot;</span><span class="p">)</span>
<span class="n">imp_coefs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">coefs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
                     <span class="n">coefs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
<span class="n">imp_coefs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;barh&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Coefficients in the ElasticNet Model&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/opt/conda/lib/python3.5/site-packages/sklearn/linear_model/coordinate_descent.py:479: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations. Fitting data with very small alpha may cause precision problems.
  ConvergenceWarning)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Best l1_ratio : 1.0
Best alpha : 0.0006
Try again for more precision with l1_ratio centered around 1.0
Best l1_ratio : 1.0
Best alpha : 0.0006
Now try again for more precision on alpha, with l1_ratio fixed at 1.0 and alpha centered around 0.0006
Best l1_ratio : 1.0
Best alpha : 0.0006
ElasticNet RMSE on Training set : 0.114111508375
ElasticNet RMSE on Test set : 0.115832132218
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_36_2.png" src="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_36_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_36_3.png" src="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_36_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ElasticNet picked 110 features and eliminated the other 209 features
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_36_5.png" src="../_images/week_8_a-study-on-regression-applied-to-the-ames-dataset_36_5.png" />
</div>
</div>
<p>The optimal L1 ratio used by ElasticNet here is equal to 1, which means it is exactly equal to the Lasso regressor we used earlier (and had it been equal to 0, it would have been exactly equal to our Ridge regressor). The model didn’t need any L2 regularization to overcome any potential L1 shortcoming.</p>
<p>Note : I tried to remove the “MSZoning_C (all)” feature, it resulted in a slightly worse CV score, but slightly better public LB score.</p>
<p><strong>Conclusion</strong></p>
<p>Putting time and effort into preparing the dataset and optimizing the regularization resulted in a decent score, better than some public scripts which use algorithms that historically perform better in Kaggle contests, like Random Forests. Being fairly new to the world of machine learning contests, I will appreciate any constructive pointer to improve, and I thank you for your time.</p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Test</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../week_1/00-tools.html">Tools for AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_1/01-readings.html">Readings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_4/01-KNIME.html">KNIME: Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_4/02-Intro-Workflow.html">Starting a Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_4/03-Churn-Example.html">Customer Churn with KNIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_4/04-visualizations.html">Data Visualization with KNIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_5/02-basic_classification.html">Basic Classification with Tensorflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_5/03-basic_text_classification.html">Text Classification with Tensorflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_5/04-basic_regression.html">Regression with Tensorflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_5/07-keras-overview.html">Keras Library Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_6/00-intro.html">Intro to Cloud Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_6/02-Google-Cloud.html">Google Cloud Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_6/01-aws.html">AWS Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_6/03-Microsoft-Azure.html">Microsoft Azure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_7/00-supervised.html">Supervised Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_7/01-unsupervised.html">Unsupervised Learning Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_7/02-regression.html">Regression Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_7/03-classification.html">Classification Models</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, J.F. Koehler.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/week_8/a-study-on-regression-applied-to-the-ames-dataset.ipynb"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>